---
name: "Check Changelog"
description: "Verify many things in changelog"

inputs:
  python-version:
    description: "Python version to use with uv"
    required: false
    default: "3.12"
  working-directory:
    description: "Directory where the command will be executed"
    required: false
    default: "."
  format-check:
    description: "Whether to run the check-format step (boolean)"
    required: false
    default: "true"
  from-push:
    description: "Indicates whether the workflow was triggered by a push event."
    required: false
    default: "false"
  summarize-news:
    description: "Origin and target file paths separated by a space."
    required: false
    default: ""

runs:
  using: "composite"
  steps:
    - name: Setup uv
      uses: astral-sh/setup-uv@v5
      with:
        python-version: "${{ inputs.python-version }}"
    - id: format
      name: Check format
      if: ${{ fromJSON(inputs.format-check) }}
      shell: bash
      run: |
        set -euo pipefail
        echo "Checking format..."
        uv run --with '${{ github.action_path }}' \
          changelogtxt check-format \
          -f ${{ inputs.working-directory }}
    - id: tag
      name: Check tag
      env:
        TAG: ${{ github.ref_name }}
        IS_TAG: ${{ github.event_name == 'push' && github.ref_type == 'tag' }}
      if: ${{ fromJSON(inputs.from-push) && fromJSON(env.IS_TAG) }}
      shell: bash
      run: |
        set -euo pipefail
        echo "Checking tag..."
        uv run --with "${{ github.action_path }}" \
          changelogtxt check-tag "${{ env.TAG }}" \
          -f ${{ inputs.working-directory }}
    - id: summarize
      name: Summarize News
      if: ${{ inputs.summarize-news != '' }}
      working-directory: ${{ inputs.working-directory }}
      shell: bash
      run: |
        set -euo pipefail
        echo "Summarizing news..."
        read origin target <<< "${{ inputs.summarize-news }}"
        echo "Origin: $origin"
        echo "Target: $target"
        uv run --with '${{ github.action_path }}' \
          changelogtxt summarize-news "$origin" "$target"
